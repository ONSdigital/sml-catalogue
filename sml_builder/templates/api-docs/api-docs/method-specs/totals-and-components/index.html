
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    
    
    
    
      <link rel="stylesheet" href="/static/assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="/static/assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="/static/assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#totals-components-correction-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
    
    <div class="md-container" data-md-component="container">
      
      
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="totals-components-correction-specification">Totals Components Correction Specification</h1>
<h2 id="10-meta">1.0 Meta</h2>
<ul>
<li>Support area – Methodology – Processing, Editing &amp; Imputation</li>
<li>Method theme – Automatic Editing</li>
<li>Status – Fully tested</li>
</ul>
<h2 id="20-terminology">2.0 Terminology</h2>
<ul>
<li>Contributor – A member of the sample; identified by a unique identifier.</li>
<li>Record – A set of values for each contributor and period.</li>
<li>Target Period – The period currently undergoing data validation.</li>
<li>Target Variable – The variable of interest that the method is working on,
 the total or components as determined by the Amend Total variable.</li>
<li>Target Record – A contributor's record in the target period.</li>
<li>Predictive Variable – A value used as a predictor for a contributor's target variable.</li>
<li>Predictive Record – The record containing a contributor's predictive value.</li>
<li>Predictive Period – The period containing predictive records; defined
 relative to the target period.</li>
<li>Auxiliary variable – The variable used as a predictor for a contributor’s
 target variable, where the predictive value is not available (e.g., where
 the contributor was not sampled in the predictive period).</li>
<li>Responder – A contributor who has responded to the survey within a given period.</li>
<li>Precision – The precision value determines the level of accuracy for the floating
 point calculations in significant figures.</li>
</ul>
<h2 id="30-introduction">3.0 Introduction</h2>
<p>The automatic editing method for totals and components correction is currently
 used in ONS business surveys to ensure fixed relationships between variables
 are satisfied. For example, when a total (e.g., total employment) is collected
 along with the component breakdown (e.g., full-time male, full-time female,
 part-time male, part-time female).</p>
<p>The primary use of the method is to automatically detect and correct errors
 in respondent data where fixed relationships have not been satisfied to
 improve the efficiency of the editing process, reduce the burden on respondents
 and survey validators and improve overall data quality.</p>
<p>This method can also be used to ensure fixed relationships between variables are
 satisfied in other data types such as imputed data to improve overall data
 quality.</p>
<p>This method can only be applied if all the components are of the same type e.g.,
 all returned or imputed. Maintaining a total and components relationship where
 components are a combination of types (e.g., returned and imputed) is outside of
 the scope for this method.</p>
<h2 id="40-assumptions">4.0 Assumptions</h2>
<ul>
<li>Target value and predictive value are well correlated</li>
<li>Target value and auxiliary value, if required, are well correlated</li>
<li>Thresholds set are a good indication of whether a value should be corrected</li>
<li>The method can only observe and satisfy one fixed relationship at a
 time (i.e., only one set of components and total)</li>
<li>Both the total value and at least one corresponding component are populated for
 the target period</li>
<li>The components are all the same data type e.g., all returned or imputed.
 The total variable type does not impact this.</li>
</ul>
<h2 id="50-method-input-and-output">5.0 Method Input and Output</h2>
<h3 id="51-input-records">5.1 Input Records</h3>
<p>Input records must include the following fields of the correct types:</p>
<ul>
<li>Unique Identifier – Any e.g., Business Reporting Unit</li>
<li>Total Variable – Target period total, numeric</li>
<li>Components Variable – Corresponding list of Total variable's components,
 numeric – nulls allowed</li>
<li>Amend Total – Select whether Total Variable for the target period should be
 automatically corrected, Boolean</li>
<li>Predictive Variable – Previous or current period total, numeric – nulls allowed</li>
<li>Auxiliary Variable – Numeric – nulls allowed</li>
<li>Precision – Numeric – nulls allowed</li>
</ul>
<p>The Amend Total variable determines whether the Total or Components variable
 will be corrected through application of the method. The chosen variable
 is then defined as the Target Variable.</p>
<p>If the current period total is used as the predictive variable, then the
 Predictive Variable and the Total Variable are the same.</p>
<p>There are additional parameters, separate to the inputs, that the user must populate
at least one of. These are:</p>
<ul>
<li>Absolute Difference Threshold</li>
<li>Percentage Difference Threshold, represented as a decimal</li>
</ul>
<p>There are multiple options for the detection method. The user may
 choose from the following:</p>
<ol>
<li>Use absolute difference only</li>
<li>Use a percentage change only</li>
<li>Use an absolute difference, and then a percentage change</li>
</ol>
<p>The user must populate the above parameters with positive non-zero values
in order to apply their chosen detection method. For example, if the user
wishes to only apply the absolute difference detection method, then this
parameter should be non-zero and the percentage difference threshold
should remain blank.
Note, populating the parameters with zeros is not equivalent to leaving
them blank.</p>
<h3 id="52-output-records">5.2 Output Records</h3>
<p>Output records shall always contain the following fields with the following types:</p>
<ul>
<li>Unique Identifier – Any e.g., Business Reporting Unit</li>
<li>Absolute Difference – Numeric, nulls allowed</li>
<li>Low Percent – Numeric, nulls allowed (see 7.1.2)</li>
<li>High Percent – Numeric, nulls allowed (see 7.1.2)</li>
<li>Final Total Variable – Numeric</li>
<li>Final Components Variable – Numeric</li>
<li>TCC Marker – To indicate the result of the Totals Components Correction
 method, string</li>
</ul>
<p>Fields of type "Any" shall be of the same type as the corresponding input
 fields as the values shall be the same in both input and output records.</p>
<p>The TCC marker must be one of the following:</p>
<ul>
<li>T = Total corrected</li>
<li>C = Components corrected</li>
<li>N = No correction required, i.e., the total is equal to the components sum</li>
<li>M = Manual editing required. This marker will identify contributors
 where the discrepancy between the total and component is deemed too
 large for automatic correction.</li>
<li>S = Method stops. This may be due to insufficient data to run the method,
 or one of the relevant zero cases as described in 6.3 has occurred.</li>
</ul>
<h2 id="60-overall-method">6.0 Overall Method</h2>
<p>This method firstly identifies if a given totals and components
 relationship has not been satisfied for a given contributor in
 the target period. If so, the method will determine
 whether the difference observed is within an acceptable tolerance.
 This tolerance is determined in one of three different ways:</p>
<ol>
<li>If the absolute difference between the sum of the components and
 its corresponding predictive total is less than or
 equal to the predefined threshold</li>
<li>If the predictive total is within an acceptable absolute percentage of the
 components sum and an absolute difference is not considered</li>
<li>If the absolute difference described above is greater than the
 predefined threshold but the predictive total is within an acceptable
 absolute percentage of the components sum</li>
</ol>
<p>If the above is satisfied, an automatic correction will be made depending
 on the Amend Total variable. If the above is not satisfied and the
 method is being applied to returned data, then the responder is contacted
 for confirmation. If the method is applied to data that is not returned
 data e.g., imputed data, then the thresholds can be set to a maximum
 value, allowing the method to automatically correct all cases where
 the total does not equal the sum of the components.</p>
<p>The rationale for automatically correcting totals/components can vary by
 data type. For example, with respondent data, it may be preferred to
 only automatically correct data if there is a small difference between
 the predictive and component variables sum in the target period as it is a
 cost-effective approach to data editing. However, if a difference greater
 than a set threshold is observed between the predictive variable and the sum
 of the component variables in the target period, then it may be preferred to not
 automatically correct data in favour of re-contacting the respondent to
 correct the data directly.</p>
<p>If the predictive total is missing, then the method is not
 applied, unless it is appropriate to use an auxiliary variable that
 is well correlated with the target variable. The auxiliary
 variable should not be read into the data if the user does not require it.
 If both variables are missing, then an appropriate marker will be output
 by the method.</p>
<h3 id="61-error-detection">6.1 Error Detection</h3>
<p>If a total for the target period does not equal the sum of its corresponding
 components in the target period for a given contributor and the components
 sum is greater than
 zero, then depending on the approach chosen, the method checks whether
 the differences observed are within an acceptable tolerance. This tolerance
 can be determined by an absolute difference, a percentage difference or a
 combination of both, as described in section 6.</p>
<p>If components sum is equal to zero and the user has selected to amend the
 total variable (Amend Total = TRUE), then the correction should not be applied.
 See section 6.3 for more details.</p>
<p>The predictive period value can either be a cleaned return, an impute
 or a construction. If this data is not available, then an auxiliary
 variable should only be used when an appropriate
 auxiliary variable exists, and is populated by the user. For example,
 when checking employment data, ONS business surveys use a register-based
 annual auxiliary variable only for surveys with annual periodicity,
 when there is no predictive variable available as this variable is well
 correlated with the target variable. The predictive variable
 should take priority over the auxiliary variable. Otherwise,
 the method should not run if there is no predictive period data available.</p>
<h3 id="62-error-correction">6.2 Error Correction</h3>
<p>If the selected condition(s) as described in section 6.1 are
 satisfied, then the target variable will be corrected, depending
 on which target variable has been selected:</p>
<ol>
<li>If Amend Total = FALSE, then the components are automatically corrected
 for the target period to be equal to the total in the target period.</li>
<li>If Amend Total = TRUE, then the total is automatically corrected for
 the target period to equal the sum of the components in the target period.</li>
</ol>
<p>The above should be applied if both the sum of the components and target period
 total are both greater than zero. Else, see section 6.3.</p>
<p>If the chosen conditions are not satisfied, then no correction
 is applied, and the responder is recontacted for confirmation if the
 target variable is a returned value.</p>
<h3 id="63-zero-cases">6.3 Zero Cases</h3>
<p>Some cases where either the target period total or the components sum equals
 zero need to be treated differently from as described in sections 6.1 and 6.2
 depending on the case as detailed below:</p>
<ol>
<li>If target total &gt; 0 and components sum = 0 and amend total = TRUE:
 No correction should be applied in this case. A total only may be provided
 if the component breakdown is unknown so would not want to remove true
 values. A suitable marker will be output by the method.</li>
<li>If target total &gt; 0 and components sum = 0 and amend total = FALSE: In this
 case, the proportions of the true components are unknown so the method cannot
 apply a correction. A suitable marker will be output by the method.</li>
<li>If target total = 0 and components sum &gt; 0 and amend total = TRUE: The total
 should be corrected if the difference observed is within the tolerances
 determined by the detection method. Else, the difference should be flagged for
 manual checking.</li>
<li>If target total = 0 and components &gt; 0 and amend total = FALSE. Apply
 correction to override the components with zeros if the difference observed is
 within the tolerances determined by the detection method. Else, the difference
 should be flagged for manual checking.</li>
</ol>
<h3 id="64-exception-handling">6.4 Exception Handling</h3>
<p>In the case of the method experiencing processing issues, the method
 shall not result in any output records. Instead, a suitable error
 description shall be emitted.</p>
<h2 id="70-calculations">7.0 Calculations</h2>
<h3 id="71-error-detection-calculations">7.1 Error Detection Calculations</h3>
<p>For all error detection approaches as described in section 6, the
 method initially identifies contributors where the following is
 not satisfied for <em>n</em> components at time <em>t</em>:</p>
<p>
<script type="math/tex; mode=display"> \large y_{1, t} + \dots + y_{n, t} = y_{total, t} </script>
</p>
<pre><code class="language-asciimath">y_{1, t} + ... + y_{n, t} = y_{total, t}
</code></pre>
<p>If the above is satisfied, then no error is detected, and the method stops.
Else, the error detection process will proceed depending on the chosen approach.</p>
<h4 id="711-absolute-difference">7.1.1 Absolute Difference</h4>
<p>If the condition described in 7.1 is not satisfied and the sum of the
 components is not equal to zero, the method then checks whether the
 following is satisfied for a given contributor:</p>
<p>
<script type="math/tex; mode=display"> \large |(y_{1, t} + \dots + y_{n, t}) - y_{total,\ predictive}|
 \leq x_{absolute} </script>
</p>
<pre><code class="language-asciimath">|(y_{1, t} + ... + y_{n, t}) - y_{total, predictive}| =&lt; x_{absolute} $$
</code></pre>
<p>Where $y_{1, t}$ to $y_{n, t}$ are the <em>n</em> corresponding components
 of the total $y_{total, t}$, $y_{total, predictive}$ is the total for the
 predictive period and $x_{absolute}$ is the predefined threshold for
 the absolute difference.</p>
<p>If the predictive value is missing, then $y_{total, predictive}$ should
 be replaced with the auxiliary variable, if
 required by the user.</p>
<h4 id="712-percentage-difference">7.1.2 Percentage Difference</h4>
<p>Where the condition described in 7.1 is not satisfied and the sum
 of the components is not equal to zero, the method then checks
 whether the following is satisfied for a given contributor:</p>
<p>Let $y_{1,t} +...+ y_{n,t} = y_{derived}$, then:</p>
<p>
<script type="math/tex; mode=display"> \large low_{percent} \leq y_{total,\ predictive} \leq high_{percent} </script>
</p>
<pre><code class="language-asciimath">low_{percent} =&lt; y_{total, predictive} =&lt; high_{percent}
</code></pre>
<p>Where,</p>
<p>
<script type="math/tex; mode=display"> \large low_{percent} = y_{derived} - (y_{derived}*x_{percent}) </script>
</p>
<p>
<script type="math/tex; mode=display"> \large high_{percent} = y_{derived} + (y_{derived}*x_{percent}) </script>
</p>
<pre><code class="language-asciimath">low_{percent} = y_{derived} - (y_{derived} * x_{percent})
</code></pre>
<pre><code class="language-asciimath">high_{percent} = y_{derived} + (y_{derived} * x_{percent})
</code></pre>
<p>Where $x_{percent}$ is the predefined percentage threshold
 represented as a decimal.</p>
<p>If the predictive value is missing, then $y_{total, predictive}$
 should be replaced with the auxiliary variable, if
 required by the user.</p>
<h4 id="713-combined-error-detection">7.1.3 Combined Error Detection</h4>
<p>As described in section 6, the user may choose to use either the absolute
 difference or the percentage difference in isolation. If the user chooses
 to combine both methods, then the absolute difference check should first
 be applied. If the absolute difference if within the acceptable tolerance,
 then the method stops, and the correction is applied. If the absolute
 difference is greater than the tolerance, then the percentage check is
 applied.</p>
<p>If the percentage check is within an acceptable tolerance, then the
 correction is applied.</p>
<p>If the percentage check is outside of the acceptable tolerance, then
 the contributor is flagged for manual checking.</p>
<h3 id="72-error-correction-calculation">7.2 Error Correction Calculation</h3>
<p>If the conditions described in the subsections of 7.1 are satisfied
 and the Amend Total variable = FALSE (amend the components), then
 for a given contributor:</p>
<p>
<script type="math/tex; mode=display"> \large y_{1, t} + \dots + y_{n, t} = y_{total, t} </script>
</p>
<pre><code class="language-asciimath">y_{1, t} + ... + y_{n, t} = y_{total, t}
</code></pre>
<p>Where $y_{1, t}$ to $y_{n, t}$ are prorated to
 equal $y_{total, t}$. For a given component $y_{k,t}$, the adjusted
 $\hat{y}_{k,t}$ is calculated by:</p>
<p>
<script type="math/tex; mode=display"> \large \hat{y}\_{k,t} = \Bigl(\frac{y_{k,t}}{y_{1, t} + \dots + y_{n, t}}
 \Bigl) * y_{total, t} </script>
</p>
<pre><code class="language-asciimath">\hat{y}_{k,t} = (\frac{y_{k,t}}{y_{1, t} + ... + y_{n, t}}) * y_{total, t}
</code></pre>
<p>If the conditions described in the subsections of 7.1 are satisfied
 and the Amend Total variable = TRUE (amend the total), then
 for a given contributor, the adjusted
 $\hat{y}_{total,t}$ is calculated by:</p>
<p>
<script type="math/tex; mode=display"> \large \hat{y}\_{total, t} = y_{1, t} + \dots + y_{n, t} </script>
</p>
<pre><code class="language-asciimath">\hat{y}_{total, t} = y_{1, t} + ... + y_{n, t}
</code></pre>
<p>If the difference between the predictive total and the sum of the components
 is greater than the thresholds described in the subsections of 7.1, then the
 data is not automatically corrected, and the data is flagged for manual
 checking.</p>

              
            </article>
          </div>
        </div>
      </main>
      
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "/static/assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="/static/assets/javascripts/bundle.e87a5f81.min.js"> </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>