{%- extends "core.html" -%}
{%- set page_title = method.name -%}
{%- set current_path = url_for("display_methods") -%}
{% from "components/external-link/_macro.njk" import onsExternalLink %}
{%- set breadcrumbs = {
  "id":"breadcrumbs",
  "ariaLabel":"breadcrumbs",
  "itemsList":[
    {
      "url": url_for("display_methods"),
      "id": "back",
      "text": 'Back',
    }
  ]
} -%}
{% from "components/status/_macro.njk" import onsStatus %}
{%- block main -%}
<h1 class="ons-u-mt-no">Method: {{ method.name }}</h1>
<h2> Method summary </h2>
{{ method.description | markdown }}

<h2> Contact details for this method </h2>
  {% from "components/external-link/_macro.njk" import onsExternalLink %}
{% if method.contact_details %}
  {{
      onsExternalLink({
        "url": 'mailto:' ~ method.contact_details ,
        "linkText": method.contact_details  
      })
  }}
{% endif %}

<hr class="ons-u-mb-m">
{% from "components/metadata/_macro.njk" import onsMetadata %}
{% set items = [] %}
{% set status =  method.method_ready | string %}
{% for item in method.method_metadata %}
{% set description = page.method_metadata[item] %}

{% do
  items.append(
    {
        "term": item,
        "descriptions": [
            {
                "description": description or "<em>n/a</em>"
            }
        ]
    }
  )
%}
{% endfor %}

{% for item in items %}
{% if item["term"]  == "Release" %}
    {% set temp=item["descriptions"][0]["description"] %}

{% if temp=="Not Released Yet" %}
    {% set item=item["descriptions"][0].__setitem__("description", '<span class="ons-status ons-status--' + status + '">' + temp + '</span>') %}

{% else %}
    {% set link = page.additional_data["Release Link"] %}
    {% set item=item["descriptions"][0].__setitem__("description", 
    '<span class="ons-status ons-status--' + status + '">
      <a href='+ link + ' target="_blank" rel="noopener noreferrer">
        <span class="ons-u-vh">Release version</span>
        ' + temp + '
        <span class="ons-u-vh">(opens in a new tab)</span>
      </a>
    </span>') %}

{% endif %}
{% endif %}
{% endfor %}
<hr class="ons-u-mb-m">
{{
  onsMetadata({
    "classes": "ons-u-mb-no ",
    "metadataLabel": "Method information",
    "termCol": "3",
    "descriptionCol": "9",
    "itemsList": [
      {
        "term": "Author",
        "descriptions": [
          {
            "description": method.author
          }
        ]
      },
      {
        "term": "Code available?",
        "descriptions": [
          {
            "description": status
          }
        ]
      },
      {
        "term": "Expert group",
        "descriptions": [
          {
            "description": method.expert_group
          }
        ]
      },
      {
        "term": "Programming language",
        "descriptions": [
          {
            "description": method.language
          }
        ]
      },
      {
        "term": "Status",
        "descriptions": [
          {
            "description": '<span class="ons-status ons-status--' + status_class.get(method.method_ready, "info") + '">' + status + '</span>'
          }
        ]
      },
      {
        "term": "Theme",
        "descriptions": [
          {
            "description": method.theme
          }
        ]
      },
    ]
  })
}}
<hr class="ons-u-mb-m">

<h2>GitHub resources</h2>
{{ method.additional_information | paras }}
{% if method.specification_link %}
{{
  onsExternalLink({
    "url":method.specification_link,
    "linkText":"Go to " ~ method.name ~ " specification on GitHub"
  })
}}
<br>
{% endif %}
{% if method.code_link %}
{{
  onsExternalLink({
    "url":method.code_link,
    "linkText":"Go to " ~ method.name ~ " code on GitHub"
  })
}}
<br>
{% endif %}
{% if method.user_documentation_link %}
{{
  onsExternalLink({
    "url":method.user_documentation_link,
    "linkText":"Go to "~ method.name ~" user documentation on GitHub"
  })
}}

{% endif %}

{% endblock main -%}